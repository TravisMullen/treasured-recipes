!function(a,b,c,d){var e=function(){function a(a,c,d){var e=b.createElement("form");e.setAttribute("method",c),e.setAttribute("action",a);for(var f=0;f<d.length;f++){var g=b.createElement("input");g.setAttribute("type","hidden"),g.setAttribute("name",d[f].name),g.setAttribute("value",d[f].value),e.appendChild(g)}b.body.appendChild(e),e.submit()}return{createAndSubmitForm:a}}(),f=function(){function a(){k.modal("hide")}function b(){o.hide()}function c(){o.show()}function f(){p.hide()}function g(){p.show()}function h(a){var b=d(this);$licenseForm=d(".license-form")[0];var c,f=b.data();i=f.billingOption,j=f.productId,b.text(f.processing).attr("disabled",!0),c={type:"POST",data:[{name:"subscription_product_id",value:j},{name:"action",value:"choose_product_denomination"},{name:"billing_option",value:i},{name:"auto_renewal",value:f.isCumulative?1:0},{name:"origin",value:"repurchase"}]},"repurchase-pic-download"===b.attr("id")&&(c.data.push({name:"src",value:$licenseForm.src.value}),c.data.push({name:"id",value:$licenseForm.id.value}),c.data.push({name:"size",value:d("input[name=size]:checked",$licenseForm).val()})),e.createAndSubmitForm("/subscribe",c.type,c.data)}var i=null,j=null,k=d("#repurchase-modal"),l=d(".repurchase-close"),m=d("#repurchase-submit"),n=d("#repurchase-banner-button"),o=d(".repurchase-banner-modal"),p=d(".repurchase-download-modal");return l.on("click",a),m.on("click",h),n.on("click",h),{hideBannerModal:b,showBannerModal:c,hideDownloadBtnModal:f,showDownloadBtnModal:g,repurchaseSubmit:h}}(),g=(function(){function a(a){var c=this;a.preventDefault(),f(c)&&b(c)}function b(a){d.ajax({url:"/share.mhtml",method:"POST",data:d(a).serialize()}).done(function(){d("#email-modal").modal("hide")}).fail(function(){d(".problem-sending",a).addClass("error-message").show()})}function e(a){var b=d(".control-group .error-message",a);b.closest(".control-group").removeClass("error"),b.remove()}function f(a){var b=!0,f=d.find("input[type=text]",a);return e(a),f.forEach(function(a){var d=a.value.trim();if(0===d.length)g(a,c.errors.enterEmail),b=!1;else if(-1!==d.indexOf(",")){var e=d.split(",");e.some(function(d){var e;return d=d.trim(),h(d)||(g(a,d+" "+c.errors.invalidEmail),b=!1,e=!0),e})}else h(d)||(g(a,d+" "+c.errors.invalidEmail),b=!1)}),b}function g(a,b){var c=d(".help-block",a.parentnode);c.length>0?c.text(b).addclass("error-message").show():d("<div class='help-block error-message'>"+b+"</div>").insertafter(a).show(),d(a).closest(".control-group").addclass("error")}function h(a){return/^[\w\-\.\+]+\@[\w\-\.]+\.\w{2,5}$/.test(a)}var i=d("#email-form");i.on("submit",a)}(),function(){function b(){return r}function g(a){r=a}function i(){return z}function j(a){s=d(this).val().trim(),l(s);var b=d(".license-form button[type=submit]")[0];"enhanced"===s?(b.id="el-download-btn",d("#custom-jpg .icon-question-sign").tooltip("disable")):(d("#custom-jpg .icon-question-sign").tooltip("enable"),b.id=""),n();var e="enhanced"===s&&c.elUpsell,f=!t&&!w;e&&f&&(k(),w=!0)}function k(){var a=d.ajax({url:"/webstack/upsell",data:{action:"get_el_upsell_modal_data",media_id:c.elUpsell.imageId,license:s,size:z},method:"get"}).done(function(a){return t=a,t&&1!==t.is_redownload?(a.has_unagreed_tos||(d("#el-agree-tos .agree-tos-center, #el-agree-tos .agree-error").hide(),h.setTosAgree(!0)),d("#el-card").text(a.card.cc_type),d("#el-last-four").text(a.card.last_four),g(a.profile_id_external),u&&clearTimeout(u),v&&(h.showElModal(),d(".el-upsell-loading").addClass("hide"),v=!1),void(w=!1)):void(w=!1)}).fail(function(){w=!1});u=setTimeout(function(){w=!1,a.abort(),v&&p(),u=null},5e3)}function l(a){d(".license-size").removeClass("enhanced standard").addClass(a),d(".license-size table").addClass("hide"),d(".license-size table."+a).removeClass("hide");var b=d(".license-size .sizes-drop:not(.hide) li.selected");"vector"==b.data("size")?d(".license-size .vector-editor").removeClass("hide"):d(".license-size .vector-editor").addClass("hide"),d("table."+a+" tr.selected").find("input").prop("checked",!0)}function m(){d(this).hasClass("disabled")||(B.removeClass("selected"),d(this).find("input[type=radio]").prop("checked",!0),z=(d(this).data("product").trim()||"").toLowerCase(),y=(d(this).data("size").trim()||"").toLowerCase(),"small"===y||"medium"===y||"custom"===y?(d(this).closest("table").find("[data-size="+y+"]").addClass("selected"),d(".license-size .table.enhanced [data-size=huge]").addClass("selected")):x.find("[data-size="+y+"]").addClass("selected"),n(),"vector"==d(this).data("size")?d(".license-size .vector-editor").removeClass("hide"):d(".license-size .vector-editor").addClass("hide"))}function n(){var a="custom"===y&&"enhanced"!==s;a?(d(".easel-button").removeClass("hide"),d(".pic-download").addClass("hide")):(d(".pic-download").removeClass("hide"),d(".easel-button").addClass("hide"))}function o(a){a.preventDefault(),v=!0;var b="enhanced"===s&&c.elUpsell;if(b){var e=!t&&u;return e?void d(".el-upsell-loading").removeClass("hide"):t?t.is_redownload?void F.submit():(v=!1,void h.showElModal()):void p()}"standard"===s&&d("input[name='license_type']").attr("disabled","disabled"),F.submit()}function p(){var a=[{name:"ws",value:"1"},{name:"action",value:"choose_product_denomination"},{name:"subscription_product_id",value:c.elUpsell.productId},{name:"campaign_name",value:c.elUpsell.campaignName}];e.createAndSubmitForm("/subscribe","post",a)}function q(b){b.preventDefault();var e=d(this).data(),f=d(".src-id").val(),g=a.location.protocol+"//"+e.editorUrl;c.easelBootstrap(e.imageId,g,"pic-page",f)}var r,s="standard",t=null,u=null,v=!1,w=!1,x=d(".license-size .table"),y=(d(".license-size .sizes .selected").data("size")||"").trim().toLowerCase(),z=(d(".license-size .sizes .selected").data("product")||"").trim().toLowerCase(),A=d(".license-size .license-form input[name=license_type]"),B=x.find("tr"),C=d("#pic-download"),D=d("#repurchase-pic-download"),E=d(".easel-button"),F=d(".license-form");d("#repurchase-modal");return A.on("click",j),x.on("click","tr",m),C.on("click",o),D.on("click",f.repurchaseSubmit),E.on("click",q),c.ImagePreview("[data-preview-values]"),d("#editorial-tooltip").popover(),d("table.standard tr.selected").find("input").prop("checked",!0),d("tr.disabled input[type=radio]").attr("disabled",!0),d("#vector-eps .icon-question-sign").tooltip(),d("#custom-jpg .icon-question-sign").tooltip(),{getProfileId:b,getProductSizeFormat:i}}()),h=function(){function b(){return n}function f(a){n=a}function h(f){var h=g.getProductSizeFormat(),i=h.split("_")[0],j=h.split("_")[1];u.is(":checked")||b()?(f.preventDefault(),d.ajax({url:"/webstack/upsell",method:"post",timeout:3e4,data:{purchase_type:"el_upsell",product_id:c.elUpsell.productId,cn:c.elUpsell.campaignName,profile_id_external:g.getProfileId(),store_error_in_session:1,use_saved_payment_data:1,payment_method:"credit_card",src:d(".license-form")[0].src.value,media_id:c.elUpsell.imageId,media_format:j,media_size:i,ack_editorial_only:!0,agree_to_tos:!0,_csrf:c.elUpsell.csrf}}).done(function(b,f,g){var h=b.errors&&b.errors[0];if(h)"payment_error"===h.type?a.location="/checkout?order_id="+b.data.open_order_id:"download_error"===h.type?(d(".el-upsell-payment-loading").addClass("hide"),m("download-error",b),o=!0):(d(".el-upsell-payment-loading").addClass("hide"),m("generic-error"));else{var k=[{name:"id",value:c.elUpsell.imageId},{name:"size",value:i},{name:"image_format",value:j},{name:"super_url",value:b.url},{name:"el_order_id",value:b.closed_order_id},{name:"ack_editorial",value:1},{name:"chosen_subscription",value:c.elUpsell.productId}];e.createAndSubmitForm("/downloading_tips.mhtml","get",k)}}).fail(function(){d(".el-upsell-payment-loading").addClass("hide"),m("generic-error")}),p.modal("hide"),d(".el-upsell-payment-loading").removeClass("hide")):(f.preventDefault(),d(".agree-tos-center",q).addClass("error"),d(".error-message",q).css({visibility:"visible"})),d("input",q).on("change",k)}function i(a){a.preventDefault(),p.modal("hide")}function j(){k(),d(".btn-primary",q).off("click"),d("input",q).off("change")}function k(){d("input",q).prop("checked")&&(d(".agree-tos-center",q).removeClass("error"),d(".error-message",q).css({visibility:"hidden"}))}function l(){if(o){var a=[{name:"src",value:d(".license-form")[0].src.value},{name:"id",value:c.elUpsell.imageId},{name:"size",value:g.getProductSizeFormat()}];e.createAndSubmitForm("/dl2_lim.mhtml","get",a)}else p.modal({keyboard:!0}).on("hide",j)}function m(a,b){"download-error"===a?(d(".el-upsell-receipt-link").attr("href",function(){return this.href+b.closed_order_id}),d(".el-upsell-download-error").show(),d(".generic-error").hide()):(d(".el-upsell-download-error").hide(),d(".generic-error").show()),s.modal({keyboard:!0})}var n=!1,o=!1,p=d("#el-upsell-modal"),q=p[0],r=d(".btn-link",q),s=d("#el-upsell-error-modal"),t=(s[0],d("#el-agree-tos")),u=t.find("input");t.find("button.btn-primary");return t.on("submit",h),r.on("click",i),{showElModal:l,isTosAgreed:b,setTosAgree:f,showErrorModal:m}}();(function(){var a=d("#subscribe-submit-button");if(a.length&&c.phrases&&c.phrases.DOWNLOAD){var b=d('<button class="btn btn-primary btn-download btn-block" name="submit_jpg" type="submit"></button>');b.html('<i class="icon-download-alt"></i> '+c.phrases.DOWNLOAD),a.replaceWith(b)}})(),function(){function a(){h.addClass("in-preview")}function c(){h.removeClass("in-preview")}function e(a){var c=d(a.currentTarget),e=c.data("image");i.modal({keyboard:!0,backdrop:!0,show:!0});var f=l.children("img").width(1).height(1),g=e.width,h=e.height,m=g/h,n=j.outerWidth(),o=j.outerHeight();if(g>n&&(g=n,h=g/m),h>o&&(h=o,g=h*m),f.length){f.css({maxWidth:e.width+"px",maxHeight:e.height+"px"}).width(g).height(h);var p=100/e.height;l.height(h-p*h)}else{var q=b.createElement("img");q.src="",q.onload=function(){var a=d(q).prop({className:"modal-img",itemprop:"image"}).css({maxWidth:e.width+"px",maxHeight:e.height+"px"}).width(g).height(h);i.addClass("preview-loaded"),k.remove(),l.append(a);var b=100/e.height;l.height(h-b*h)},q.src=c.prop("href")}a.preventDefault()}function f(a){d(a.target).is(":not(img.modal-img)")&&i.modal("hide"),a.preventDefault()}function g(){d("delte-this-code").hide()}var h=d("body"),i=d("#preview-modal"),j=i.find(".preview-modal-body"),k=i.find(".preview-modal-loader"),l=j.find(".preview-modal-img"),m=h.find(".main-image a.preview-subscribe"),n=d(".preview-modal-trigger");m.prop("href",m.data("href")),i.on("show",a),i.on("hide",c),i.on("click",f),n.on("click",e),g()}()}(window,document,Ss,jQuery);